# AutoDigiSign README

by [hsulihuang](https://github.com/hsulihuang)

## Overview

AutoDigiSign is a Python-based automated document signing tool designed to streamline digital signatures for medical records at National Taiwan University Hospital (NTUH). This project integrates multiple utilities to facilitate login, manage digital signatures, and handle email communications, creating an efficient workflow. 

## Project Structure

The project contains several modules, each responsible for a different aspect of the AutoDigiSign workflow:

```
inputs
 ├── configs
 │   ├── email_config.ini
 │   └── credentials.ini
 └── employee_list.txt
outputs
 ├── captcha
 └── logs
src
 ├── batch
 │   └── reboot_win64.bat
 ├── utils
 │   ├── autodigisign_utils.py
 │   ├── email_utils.py
 │   ├── item_locator.py
 │   └── logging_utils.py
 └── main.py
WebDriver
 ├── chromedriver-mac-arm64-v130
 └── edgedriver_win64_v125
CHANGELOG.md
launcher_win64.bat
LICENSE.md
README.md
requirements.txt
```

### Folder and File Descriptions

- **inputs**: Contains input configuration and data files.
  - **configs**: Stores configuration files.
    - `credentials.ini`: Contains the credentials required to log in and access Healthcare Certification Authority (HCA) services for digital signature purposes.
    - `email_config.ini`: Configuration settings for email automation.
  - `employee_list.txt`: Contains the list of employees involved in the document signing process, including their ID and name.
- **outputs**: Contains output files generated by the system.
  - **captcha**: Stores captcha images if used during automation.
  - **logs**: Stores log files generated by the system for tracking activity.
- **src**: The main source code directory.
  - **batch**: Contains batch scripts for specific system operations.
    - `reboot_win64.bat` (Optional): A batch file to reboot the system on Windows 64-bit.
  - **utils**: Contains utility modules.
    - `autodigisign_utils.py`: Helper functions and classes for managing digital signatures.
    - `email_utils.py`: Functions for handling email communication.
    - `item_locator.py`: Logic for locating items in the working directory.
    - `logging_utils.py`: Functions for logging activities.
  - `main.py`: The main script that initiates the automation process.
- **WebDriver**: Contains drivers needed for browser automation.
  - `chromedriver-mac-arm64-v130`: Chrome WebDriver for macOS ARM64.
  - `edgedriver_win64_v125`: Edge WebDriver for Windows 64-bit.
- **CHANGELOG.md**: Records changes and updates made to the project.
- **launcher_win64.bat**: Batch script to launch the application on Windows 64-bit.
- **LICENSE.md**: Contains the MIT License under which this project is distributed.
- **README.md**: Documentation for the project.
- **requirements.txt**: Specifies all dependencies required for the project.

### Modules

#### `autodigisign_utils.py`

Contains core utility functions to apply digital signatures, verify them, and process document formats. It works seamlessly with different types of documents to ensure signature integrity and legal compliance.

#### `logging_utils.py`

This module provides logging capabilities to keep track of system activity. Log messages are categorized into different levels such as INFO, WARNING, and ERROR, making it easier to diagnose and understand the behavior of the system.

#### `item_locator.py`

This module is responsible for locating items within documents that need signatures. It uses various techniques to identify fields that require user attention, ensuring that the correct items are processed.

#### `email_utils.py`

Automates email operations, allowing signed documents to be automatically sent or received for processing. This module integrates with email servers and supports attachment handling.

## Requirements

To use AutoDigiSign, you will need:

- **Python 3.9+**, with required packages specified in the `requirements.txt` file. Install the dependencies using:
  ```sh
  pip install -r requirements.txt
  ```
- **WebDriver**: Use **ChromeDriver** on macOS and **EdgeDriver** on Windows for browser automation. Please ensure to download the appropriate WebDriver version that matches the version of Chrome or Edge installed on your computer.

## Installation

1. **Clone the Repository**

   ```sh
   git clone https://github.com/hsulihuang/AutoDigiSign
   cd AutoDigiSign
   ```

2. **Set Up Environment**

   - Make sure you have Python and the required Python packages installed.
   - Download and set up **Tesseract OCR**. Update the `tesseract_cmd` path in the script, if necessary, to point to your installation location.
   - Download **Microsoft Edge WebDriver** or **ChromeDriver** that matches your browser version.

3. **Set up Configurations**

   - Create files named `employee_ids.txt`, `credentials.ini` and `email_config.ini` as follows.

### Employee List Setup

Create an `employee_list.txt` file in the `inputs` directory, containing the list of employees involved in the document signing process. Each line should include an employee's ID and name, separated by a space, formatted as follows:

```
<employee_id> <employee_name>
```

For example:

```
012345 Joe Smith
142857 Jean Doe
```

### Credentials Setup

Create a `credentials.ini` file in the `inputs/configs` directory to store the login credentials required for accessing the NTUH portal and Healthcare Certification Authority (HCA) IC card services. The file should include the following fields:

```ini
[credentials]
username = <your_employee_id>
password = <your_portal_password>
pincode = <your_ic_card_pincode>
```

Replace `<your_employee_id>`, `<your_portal_password>`, and `<your_ic_card_pincode>` with the appropriate values.

### Setting up SMTP in Gmail Settings (Optional)

To use the email sending functionality in this script, you need to set up SMTP access in your Gmail settings. Follow the steps below to configure Gmail SMTP for your account:

1. **Enable Two-Step Verification**

   - Go to your [Google Account Security Settings](https://myaccount.google.com/security).
   - Under "Signing in to Google," enable **Two-Step Verification**. This adds an additional layer of security to your account.

2. **Generate an App Password**

   - Once Two-Step Verification is enabled, go to the **App Passwords** section in the security settings.
   - Select "Mail" as the app and "Windows Computer" (or another device name) as the device.
   - Click "Generate" to receive a 16-character **App Password**. Copy this password, as you will need it to set up the script.

3. **Configure the SMTP Settings in the Config File**

   - Create a file named `email_config.ini` in the `inputs/configs` directory.
   - Add the following configuration to the file:
     ```ini
     [email]
     smtp_server = smtp.gmail.com
     smtp_port = 587
     sender_email = <your_email@gmail.com>
     sender_password = <your_app_password_here>
     recipient_email = <recipient1@gmail.com>, <recipient2@gmail.com>
     ```
   - Replace `your_email@gmail.com` with your Gmail address, `your_app_password_here` with the 16-character App Password generated earlier, and `recipient1@gmail.com, recipient2@gmail.com` with the intended recipient(s) email address.

4. **Verify Less Secure Apps** (Optional)

   - Google has restricted access for less secure apps by default. Using an **App Password** should work without enabling this setting.
   - If you do not use App Passwords, you may need to enable access for [Less Secure Apps](https://myaccount.google.com/lesssecureapps), but this is not recommended for security reasons.

5. **Test the Email Functionality**

   - Run the script to test whether it successfully sends an email. If there are any issues, you may receive an error indicating that the credentials were not accepted, in which case you should double-check your email, App Password, and SMTP configuration.

## Usage

### Running on Windows

The main script (`main.py`) is the entry point of the application. To run the program on Windows:

1. **Double-click the Batch File**

   - Simply double-click the provided `launcher_win64.bat` file to start the program on Windows.

2. **Automated Scheduling with Windows Task Scheduler**

   - Use Windows' **Task Scheduler** ("工作排程器") to set up the application to run automatically at a specific time, allowing you to automate the process without manual intervention.

3. **Regular System Reboot (Optional)**

   - It is recommended to reboot your Windows system regularly to ensure optimal performance and stability. This can also be automated using Windows Task Scheduler along with the provided `reboot_win64.bat` file.

### Running on macOS

To run AutoDigiSign on macOS, follow these steps:

1. **Run the Application**

   Open the terminal and navigate to the working directory :

   ```sh
   cd ~path/to/AutoDigiSign
   ```

   - Run the `main.py` script:

   ```sh
   python src/main.py
   ```

2. **Automate with Launchd**

   - You can use `launchd` to schedule the script to run automatically at specific times. Create a `.plist` file to define the schedule and load it using:

   ```sh
   launchctl load ~/Library/LaunchAgents/com.example.autodigisign.plist
   ```

### Logging

All activities are logged for tracking purposes. Logs are stored in `outputs/logs`, providing details on the progress of each task and any encountered issues. This can be helpful for debugging and monitoring the signing process.

## License

This project is licensed under the MIT License. See `LICENSE.md` for more details.

## Contact

Feel free to contribute to this project by creating pull requests or opening issues on GitHub. Contributions can include code improvements, additional features, or bug fixes. Please refer to the [GitHub repository](https://github.com/hsulihuang/AutoDigiSign) for more information.
